import { Request, Response, NextFunction } from "express";
import { v4 as uuid } from "uuid";
import { validationResult } from "express-validator";

import getCoordsForAddress from "../util/location";
import HttpError from "../models/http-error";
import { placeModel as Place} from '../models/place'

interface Place {
  id: string;
  title: string;
  description: string;
  location: {
    lat: number;
    lng: number;
  };
  address: string;
  creator: string;
}

let DUMMY_PLACES = [
  {
    id: "p1",
    title: "Empire State Building",
    description: "Tall building",
    location: {
      lat: 40.7484405,
      lng: -73.9878531,
    },
    address: "20 W 34th St, New York, NY 10001",
    creator: "u1",
  },
];

export const getPlaceById = (
  req: Request,
  res: Response,
  next: NextFunction
) => {
  const placeId = req.params.pid;
  const place = DUMMY_PLACES.find((p) => p.id === placeId);
  if (!place) {
    return next(
      new HttpError("Could not find place for provided place ID", 404)
    ); // will work with async code that will be implemented later
  }
  res.json({ place });
};

export const getPlacesByUserId = (
  req: Request,
  res: Response,
  next: NextFunction
) => {
  const userId = req.params.uid;
  const places = DUMMY_PLACES.filter((p) => p.creator === userId);
  if (!places || places.length === 0) {
    return next(
      new HttpError("Could not find places for provided user ID", 404)
    );
  }
  res.json({ places });
};

export const createPlace = async (
  req: Request,
  res: Response,
  next: NextFunction
) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    return next(new HttpError("Invalid inputs.", 422));
  }
  const { title, description, address, creator } = req.body;

  let location;
  try {
    location = await getCoordsForAddress(address);
  } catch (error) {
    return next(error);
  }

  const createdPlace = new Place({
    title,
    description,
    address,
    location,
    image: 'data:image/jpeg;base64,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',
    creator
  })

  try {
    await createdPlace.save();
  } catch (err) {
    const error = new HttpError('Could not save product.', 500);
    return next(error);
  }


  res.status(201).json({ place: createdPlace });
};

export const updatePlace = (
  req: Request,
  res: Response,
  next: NextFunction
) => {
  const errors = validationResult(req);
  if (!errors.isEmpty()) {
    throw new HttpError("Invalid inputs.", 422);
  }
  const placeId = req.params.pid;
  const { title, description } = req.body;
  const place = { ...DUMMY_PLACES.find((p) => p.id === placeId) }; //best practice to copy and object instead of directly modifying it

  if (!place) {
    return next(new HttpError("Place not found", 404));
  }

  const placeIndex = DUMMY_PLACES.findIndex((p) => p.id === placeId);

  place!.title = title;
  place!.description = description;

  DUMMY_PLACES[placeIndex] = place as Place;

  res.status(200).json({ place: place });
};

export const deletePlace = (
  req: Request,
  res: Response,
  next: NextFunction
) => {
  const placeId = req.params.pid;
  if (!DUMMY_PLACES.find((p) => p.id === placeId)) {
    throw new HttpError("No place found to delete", 404);
  }
  DUMMY_PLACES = DUMMY_PLACES.filter((p) => p.id !== placeId);
  res.status(200).json({ message: "Deleted place" });
};
